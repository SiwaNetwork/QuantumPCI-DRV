# Quantum-PCI TimeCard PTP OCP - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
2. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥—Ä–∞–π–≤–µ—Ä–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–¥—Ä–∞–π–≤–µ—Ä–∞)
3. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-—Å–∏—Å—Ç–µ–º—ã)
4. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ sysfs](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—á–µ—Ä–µ–∑-sysfs)
5. [API –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã](#api-–∏-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)
6. [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **–û–°**: Linux —Å —è–¥—Ä–æ–º 5.12+
- **–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ**: TimeCard PTP OCP (Rev C+)
- **BIOS**: VT-d –≤–∫–ª—é—á–µ–Ω
- **Python**: 3.7+ (–¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥—Ä–∞–π–≤–µ—Ä–∞
```bash
# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥—Ä–∞–π–≤–µ—Ä–∞
cd –î–†–ê–ô–í–ï–†–ê/

# –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∞
./remake
sudo modprobe ptp_ocp

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
ls -la /sys/class/timecard/ocp0/
lspci -d 1d9b:  # –î–ª—è Quantum-PCI TimeCard
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```bash
# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
cd ptp-monitoring/

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
python3 demo-extended.py
```

### –®–∞–≥ 3: –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º
- **üìä Dashboard**: http://localhost:8080/dashboard
- **üì± Mobile PWA**: http://localhost:8080/pwa
- **üîß API Docs**: http://localhost:8080/api/

---

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥—Ä–∞–π–≤–µ—Ä–∞

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å | PCI ID | –ú–æ–¥–µ–ª—å |
|--------------|--------|--------|
| Quantum-PCI | 0x1d9b:0x0400 | TimeCard |
| Orolia | 0x1ad7:0xa000 | ART Card |
| ADVA | 0x0b0b:0x0410 | Timecard |

### –ü—Ä–æ—Ü–µ—Å—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ VT-d –≤ BIOS
dmesg | grep -i vt-d

# 2. –ö–æ–º–ø–∏–ª—è—Ü–∏—è –¥—Ä–∞–π–≤–µ—Ä–∞
cd –î–†–ê–ô–í–ï–†–ê/
./remake

# 3. –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—è
sudo modprobe ptp_ocp

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
lsmod | grep ptp_ocp
dmesg | tail -20
```

### –°–æ–∑–¥–∞–≤–∞–µ–º—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—è–≤—è—Ç—Å—è:
- `/dev/ptp4` - PTP POSIX clock
- `/dev/ttyS5` - GNSS serial
- `/dev/ttyS6` - Atomic clock serial
- `/dev/ttyS7` - NMEA Master serial
- `/dev/i2c-*` - I2C —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã

### –†–µ–∂–∏–º—ã –∑–∞–ø—É—Å–∫–∞

#### 1. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
cd ptp-monitoring/
python3 demo-extended.py
```

#### 2. Docker —Ä–µ–∂–∏–º (production)
```bash
./start-monitoring-stack.sh start docker
```

#### 3. –ë–∞–∑–æ–≤—ã–π —Ä–µ–∂–∏–º (legacy)
```bash
python3 demo.py
```

### –§—É–Ω–∫—Ü–∏–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ú–µ—Ç—Ä–∏–∫–∏ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|---------|----------|
| **üå°Ô∏è Thermal** | 6 —Å–µ–Ω—Å–æ—Ä–æ–≤ | FPGA, –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä, –ø–ª–∞—Ç–∞, ambient, PLL, DDR |
| **‚ö° Power** | 4 voltage rails | 3.3V, 1.8V, 1.2V, 12V + –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ç–æ–∫–∞ |
| **üõ∞Ô∏è GNSS** | 4 —Å–æ–∑–≤–µ–∑–¥–∏—è | GPS, GLONASS, Galileo, BeiDou |
| **üì° PTP** | –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ | Offset, path delay, packet stats |
| **‚ö° Oscillator** | Allan deviation | –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, lock status, frequency error |
| **üîß Hardware** | –°—Ç–∞—Ç—É—Å—ã | LEDs, SMA, FPGA, network ports |

---

## üóÇÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ sysfs

### –û—Å–Ω–æ–≤–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
```
/sys/class/timecard/ocp0/
```

### –ö–ª—é—á–µ–≤—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã

#### –ò—Å—Ç–æ—á–Ω–∏–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–µ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
cat /sys/class/timecard/ocp0/clock_source

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (GNSS/MAC/IRIG-B/external)
echo "GNSS" > /sys/class/timecard/ocp0/clock_source
```

#### SMA –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä—ã
```bash
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—Ö–æ–¥–æ–≤/–≤—ã—Ö–æ–¥–æ–≤
echo "PPS" > /sys/class/timecard/ocp0/sma1_in
echo "10MHz" > /sys/class/timecard/ocp0/sma3_out
```

#### –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –∑–∞–¥–µ—Ä–∂–µ–∫
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–µ—Ä–∂–µ–∫ –≤ –Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥–∞—Ö
echo 50 > /sys/class/timecard/ocp0/external_pps_cable_delay
echo 0 > /sys/class/timecard/ocp0/internal_pps_cable_delay
```

#### –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º
```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—É—Ç–µ–π –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º
tty=$(basename $(readlink /sys/class/timecard/ocp0/ttyGNSS))
ptp=$(basename $(readlink /sys/class/timecard/ocp0/ptp))

echo "/dev/$tty"  # /dev/ttyS5
echo "/dev/$ptp"  # /dev/ptp4
```

---

## üåê API –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

### REST API Endpoints

#### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
```bash
# –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
curl http://localhost:8080/api/health

# –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
curl http://localhost:8080/api/metrics/extended

# –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
curl http://localhost:8080/api/devices
```

#### –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
```bash
# PTP –º–µ—Ç—Ä–∏–∫–∏
curl http://localhost:8080/api/metrics/ptp/advanced

# –¢–µ–ø–ª–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
curl http://localhost:8080/api/metrics/thermal

# GNSS –º–µ—Ç—Ä–∏–∫–∏
curl http://localhost:8080/api/metrics/gnss

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –∞–ª–µ—Ä—Ç–æ–≤
curl http://localhost:8080/api/alerts
```

### WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
```javascript
const socket = io();
socket.on('metrics_update', (data) => {
    console.log('New metrics:', data);
});
```

---

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –î—Ä–∞–π–≤–µ—Ä –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ VT-d
dmesg | grep -i vt-d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
lspci -d 1d9b: -vv

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—è
sudo rmmod ptp_ocp
sudo modprobe ptp_ocp
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç –º–µ—Ç—Ä–∏–∫ –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ sysfs
ls -la /sys/class/timecard/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
sudo chmod 644 /sys/class/timecard/ocp0/*

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl -v http://localhost:8080/api/health
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ WebSocket
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
sudo lsof -i :8080

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–∫–æ–π
python3 demo-extended.py --debug
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```bash
# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ PTP
sudo ptp4l -i enp1s0 -m

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ PTP
sudo pmc -u -b 0 'GET CURRENT_DATA_SET'

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ GNSS
cat /dev/ttyS5 | grep -E 'GGA|RMC'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä
find /sys/class/timecard/ocp0/ -name "*temp*" -exec cat {} \;
```

---

## üìå –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥—Ä–∞–π–≤–µ—Ä–∞](–î–†–ê–ô–í–ï–†–ê/–°–¢–†–£–ö–¢–£–†–ê_–î–†–ê–ô–í–ï–†–ê.md)
- [SYSFS –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å](–î–†–ê–ô–í–ï–†–ê/SYSFS_–ò–ù–¢–ï–†–§–ï–ô–°.md)
- [–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤](–î–†–ê–ô–í–ï–†–ê/–î–û–ë–ê–í–õ–ï–ù–ò–ï_–ù–û–í–´–•_–£–°–¢–†–û–ô–°–¢–í.md)

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- –î—Ä–∞–π–≤–µ—Ä: `–î–†–ê–ô–í–ï–†–ê/ptp_ocp.c`
- API: `ptp-monitoring/api/timecard-extended-api.py`
- Dashboard: `ptp-monitoring/web/timecard-dashboard.html`

### –õ–æ–≥–∏ –∏ —ç–∫—Å–ø–æ—Ä—Ç
```bash
# –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤
curl http://localhost:8080/api/logs/export > timecard-logs.txt

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
journalctl -u ptp4l -f
dmesg | grep ptp_ocp
```

---

## üí° –°–æ–≤–µ—Ç—ã –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –£–≤–µ–ª–∏—á—å—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è production
2. **–†–µ—Å—É—Ä—Å—ã**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ—Ä–æ–≥–∏ –∞–ª–µ—Ä—Ç–æ–≤ –ø–æ–¥ –≤–∞—à–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –°–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ Grafana

---

*TimeCard PTP OCP - Professional timing solution*