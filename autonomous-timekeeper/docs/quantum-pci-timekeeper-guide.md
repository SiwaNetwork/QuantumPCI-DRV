# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Quantum-PCI –∫–∞–∫ —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è –≤—Ä–µ–º–µ–Ω–∏

## üéØ –û–±–∑–æ—Ä

–î–∞–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–∞—Ä—Ç—ã Quantum-PCI –≤ –∫–∞—á–µ—Å—Ç–≤–µ **—Ö—Ä–∞–Ω–∏—Ç–µ–ª—è –≤—Ä–µ–º–µ–Ω–∏** (Time Keeper) –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ –∫–∞—Ä—Ç–∞ –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è **–±–µ–∑ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø—Ä–∏–µ–º–Ω–∏–∫–æ–≤ GNSS**. –í —ç—Ç–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏ Quantum-PCI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–π –≤—ã—Å–æ–∫–æ—Ç–æ—á–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–ª—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–≥–æ –≤–µ–¥–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –ø—Ä–æ–ø–∞–¥–∞–Ω–∏–∏ NTP —Å–µ—Ä–≤–µ—Ä–æ–≤.

## üìã –°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è:
- Quantum-PCI –∫–∞—Ä—Ç–∞ **–±–µ–∑ GNSS –ø—Ä–∏–µ–º–Ω–∏–∫–∞**
- –¢—Ä–µ–±—É–µ—Ç—Å—è **–∞–≤—Ç–æ–Ω–æ–º–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏** –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–µ—Ç–∏
- –ù—É–∂–Ω–∞ **–≤—ã—Å–æ–∫–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** —á–∞—Å—Ç–æ—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
- –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ **NTP —Å–µ—Ä–≤–µ—Ä** –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- ‚úÖ **–ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞** –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ **–í—ã—Å–æ–∫–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** —á–∞—Å—Ç–æ—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
- ‚úÖ **NTP —Å–µ—Ä–≤–µ—Ä** –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
- ‚úÖ **–ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã** –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ —Ä–∞–±–æ—Ç—ã
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –¥—Ä–µ–π—Ñ–∞** –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Ç–∏

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- Quantum-PCI –∫–∞—Ä—Ç–∞ —Å –≤—ã—Å–æ–∫–æ—Ç–æ—á–Ω—ã–º –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–º
- –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä `ptp_ocp`
- –î–æ—Å—Ç—É–ø –∫ `/sys/class/timecard/` –∏ `/dev/ptp*`

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- Linux —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π PTP
- Chrony 4.5+
- Python 3.8+ (–¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)
- –ü—Ä–∞–≤–∞ root –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ø–ø–∞—Ä–∞—Ç—É—Ä—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥—Ä–∞–π–≤–µ—Ä–∞
lsmod | grep ptp_ocp

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
ls -la /sys/class/timecard/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ PTP —É—Å—Ç—Ä–æ–π—Å—Ç–≤
ls -la /dev/ptp*

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Quantum-PCI
cat /sys/class/timecard/ocp0/clock_source
cat /sys/class/timecard/ocp0/gnss_sync
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î—Ä–∞–π–≤–µ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω
- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ `ocp0` –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ
- PTP —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ `/dev/ptp0` –∏ `/dev/ptp1` –¥–æ—Å—Ç—É–ø–Ω—ã
- GNSS —Å—Ç–∞—Ç—É—Å: `LOST` –∏–ª–∏ `UNKNOWN` (–Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –∫–∞—Ä—Ç –±–µ–∑ GNSS)

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install chrony ntpdate bc

# RHEL/CentOS/Fedora
sudo yum install chrony ntpdate bc
# –∏–ª–∏
sudo dnf install chrony ntpdate bc
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Chrony

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `/etc/chrony/chrony.conf`:

```bash
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Quantum-PCI –∫–∞–∫ —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è –≤—Ä–µ–º–µ–Ω–∏
# –°—Ü–µ–Ω–∞—Ä–∏–π: NTP —Å–µ—Ä–≤–µ—Ä—ã + Quantum-PCI fallback

# =============================================================================
# –ò–°–¢–û–ß–ù–ò–ö–ò –í–†–ï–ú–ï–ù–ò (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)
# =============================================================================

# 1. NTP —Å–µ—Ä–≤–µ—Ä—ã –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –∫–∞–∫ –û–°–ù–û–í–ù–´–ï –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –≤—Ä–µ–º–µ–Ω–∏
server 0.pool.ntp.org iburst minpoll 4 maxpoll 10 prefer
server 1.pool.ntp.org iburst minpoll 4 maxpoll 10 prefer
server 2.pool.ntp.org iburst minpoll 4 maxpoll 10 prefer
server 3.pool.ntp.org iburst minpoll 4 maxpoll 10 prefer

# 2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤—ã—Å–æ–∫–æ—Ç–æ—á–Ω—ã–µ NTP —Å–µ—Ä–≤–µ—Ä—ã
server time.google.com iburst minpoll 4 maxpoll 10
server time.cloudflare.com iburst minpoll 4 maxpoll 10
server ntp.ubuntu.com iburst minpoll 4 maxpoll 10

# 3. Quantum-PCI –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ (–Ω–∏–∑—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
# –í—ã—Å–æ–∫–æ—Ç–æ—á–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ NTP
refclock PHC /dev/ptp1 poll 3 dpoll -2 offset 0 stratum 2 precision 1e-9

# =============================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò –ê–í–¢–û–ù–û–ú–ù–û–ì–û –•–†–ê–ù–ï–ù–ò–Ø (HOLDOVER)
# =============================================================================

# –§–∞–π–ª –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥—Ä–µ–π—Ñ–µ —á–∞—Å–æ–≤
driftfile /var/lib/chrony/drift

# =============================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò
# =============================================================================

# –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—á–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
makestep 1.0 3

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è RTC —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ —á–∞—Å–∞–º–∏
rtcsync

# –ü–ª–∞–≤–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏
smoothtime 400 0.01 leaponly

# =============================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò –¢–û–ß–ù–û–°–¢–ò –ò –°–¢–ê–ë–ò–õ–¨–ù–û–°–¢–ò
# =============================================================================

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã (ppm)
maxupdateskew 100.0

# –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
corrtimeratio 3

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –¥—Ä–µ–π—Ñ —á–∞—Å—Ç–æ—Ç—ã (ppm) - —É–≤–µ–ª–∏—á–µ–Ω –¥–ª—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Ä–∞–±–æ—Ç—ã
maxdrift 1000

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è –¥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (—Å–µ–∫—É–Ω–¥—ã)
maxdistance 1.0

# –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
minsources 2

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ç–æ—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å NTP
maxchange 100 1 2

# =============================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò NTP –°–ï–†–í–ï–†–ê
# =============================================================================

# –õ–æ–∫–∞–ª—å–Ω—ã–π NTP —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–µ—Ç–∏
local stratum 2

# –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
allow 192.168.0.0/16
allow 10.0.0.0/8
allow 172.16.0.0/12

# –ü–æ—Ä—Ç NTP
port 123

# =============================================================================
# –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ò –ú–û–ù–ò–¢–û–†–ò–ù–ì
# =============================================================================

# –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ª–æ–≥–æ–≤
logdir /var/log/chrony

# –¢–∏–ø—ã –ª–æ–≥–∏—Ä—É–µ–º–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
log tracking measurements statistics

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–æ–ª—å—à–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (—Å–µ–∫—É–Ω–¥—ã)
logchange 0.001

# =============================================================================
# –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨
# =============================================================================

# –ê–¥—Ä–µ—Å–∞ –¥–ª—è –∫–æ–º–∞–Ω–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
bindcmdaddress 127.0.0.1
bindcmdaddress ::1

# –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
cmdallow 127.0.0.1
cmdallow ::1

# =============================================================================
# –û–ë–†–ê–ë–û–¢–ö–ê LEAP SECONDS
# =============================================================================

# –†–µ–∂–∏–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ leap seconds
leapsecmode slew
maxslewrate 83333.333

# =============================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò –î–õ–Ø –í–´–°–û–ö–û–ô –ù–ê–ì–†–£–ó–ö–ò
# =============================================================================

# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
ratelimit interval 1 burst 16 leak 2

# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
clientloglimit 1048576
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

```bash
# –ü—Ä–∞–≤–∞ –Ω–∞ PTP —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
sudo chmod 666 /dev/ptp*

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤
sudo mkdir -p /var/log/chrony
sudo chown chrony:chrony /var/log/chrony
```

### 5. –ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã
sudo systemctl restart chrony

# –í–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
sudo systemctl enable chrony

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status chrony

# –û–∂–∏–¥–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (30-60 —Å–µ–∫—É–Ω–¥)
sleep 60

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
chronyc tracking

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
chronyc sources -v
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/usr/local/bin/quantum-timekeeper-monitor.sh`:

```bash
#!/bin/bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Quantum-PCI –∫–∞–∫ —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è –≤—Ä–µ–º–µ–Ω–∏

echo "=== –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Quantum-PCI Time Keeper ==="
echo "–í—Ä–µ–º—è: $(date)"
echo

echo "--- –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ ---"
chronyc tracking
echo

echo "--- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ ---"
chronyc sources -v
echo

echo "--- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ ---"
chronyc sourcestats
echo

echo "--- Quantum-PCI —Å—Ç–∞—Ç—É—Å ---"
if [ -d /sys/class/timecard/ocp0 ]; then
    echo "Clock source: $(cat /sys/class/timecard/ocp0/clock_source 2>/dev/null || echo 'N/A')"
    echo "GNSS sync: $(cat /sys/class/timecard/ocp0/gnss_sync 2>/dev/null || echo 'N/A')"
    echo "Clock drift: $(cat /sys/class/timecard/ocp0/clock_status_drift 2>/dev/null || echo 'N/A')"
    echo "Clock offset: $(cat /sys/class/timecard/ocp0/clock_status_offset 2>/dev/null || echo 'N/A')"
else
    echo "TimeCard sysfs –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
fi
echo

echo "--- –°–µ—Ç–µ–≤—ã–µ –∫–ª–∏–µ–Ω—Ç—ã ---"
chronyc clients 2>/dev/null || echo "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"
echo

echo "--- –°–∏—Å—Ç–µ–º–Ω–æ–µ –≤—Ä–µ–º—è ---"
echo "System time: $(date)"
echo "UTC time: $(date -u)"
echo "Uptime: $(uptime)"
```

–°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
sudo chmod +x /usr/local/bin/quantum-timekeeper-monitor.sh
```

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
/usr/local/bin/quantum-timekeeper-monitor.sh

# –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
chronyc tracking

# –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –≤—Ä–µ–º–µ–Ω–∏
chronyc sources -v

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
chronyc sourcestats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ NTP
chronyc clients

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
sudo tail -f /var/log/chrony/chrony.log
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: Quantum-PCI –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- `ls /sys/class/timecard/` –ø—É—Å—Ç–∞—è
- `ls /dev/ptp*` –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥—Ä–∞–π–≤–µ—Ä–∞
lsmod | grep ptp_ocp

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥—Ä–∞–π–≤–µ—Ä–∞
sudo modprobe ptp_ocp

# –ü—Ä–æ–≤–µ—Ä–∫–∞ PCI —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
lspci | grep -i quantum
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–æ–ª—å—à–æ–π offset

**–°–∏–º–ø—Ç–æ–º—ã:**
- Offset > 1 —Å–µ–∫—É–Ω–¥—ã
- Quantum-PCI –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ "falseticker"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
sudo chronyc makestep

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ PTP —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
ls -la /dev/ptp*

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
# –í /etc/chrony/chrony.conf –∏–∑–º–µ–Ω–∏—Ç—å:
# refclock PHC /dev/ptp0 –Ω–∞ refclock PHC /dev/ptp1
```

### –ü—Ä–æ–±–ª–µ–º–∞: NTP —Å–µ—Ä–≤–µ—Ä—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í—Å–µ NTP —Å–µ—Ä–≤–µ—Ä—ã –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ "?"
- –°–∏—Å—Ç–µ–º–∞ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
ping -c 3 8.8.8.8

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ NTP —Å–µ—Ä–≤–µ—Ä–æ–≤
ntpdate -q 0.pool.ntp.org

# –í—Ä–µ–º–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ Quantum-PCI
# –í /etc/chrony/chrony.conf –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å NTP —Å–µ—Ä–≤–µ—Ä—ã
```

### –ü—Ä–æ–±–ª–µ–º–∞: –í—ã—Å–æ–∫–∏–π –¥—Ä–µ–π—Ñ —á–∞—Å—Ç–æ—Ç—ã

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ß–∞—Å—Ç—ã–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
- –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ maxdrift –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
# maxdrift 1000 -> maxdrift 2000

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
cat /sys/class/timecard/ocp0/temperature_table 2>/dev/null || echo "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
```

## üìä –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏

```bash
# –í /etc/chrony/chrony.conf –¥–æ–±–∞–≤–∏—Ç—å:

# –ë–æ–ª–µ–µ —á–∞—Å—Ç—ã–π –æ–ø—Ä–æ—Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
server 0.pool.ntp.org iburst minpoll 3 maxpoll 6

# –°—Ç—Ä–æ–≥–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
maxdistance 0.5
maxchange 50 1 2

# –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logchange 0.0001
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

```bash
# –í /etc/chrony/chrony.conf –¥–æ–±–∞–≤–∏—Ç—å:

# –ú–µ–Ω–µ–µ —á–∞—Å—Ç—ã–π –æ–ø—Ä–æ—Å –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
server 0.pool.ntp.org iburst minpoll 6 maxpoll 12

# –ë–æ–ª–µ–µ –º—è–≥–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
maxdistance 2.0
maxchange 200 1 2

# –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –¥—Ä–µ–π—Ñ –¥–ª—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Ä–∞–±–æ—Ç—ã
maxdrift 2000
```

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
#!/bin/bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Quantum-PCI –∫–∞–∫ —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è –≤—Ä–µ–º–µ–Ω–∏

set -e

echo "=== –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Quantum-PCI Time Keeper ==="

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ root
if [ "$EUID" -ne 0 ]; then
    echo "–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —Å –ø—Ä–∞–≤–∞–º–∏ root"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Quantum-PCI
if [ ! -d "/sys/class/timecard/ocp0" ]; then
    echo "–û—à–∏–±–∫–∞: Quantum-PCI —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
    exit 1
fi

# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp /etc/chrony/chrony.conf /etc/chrony/chrony.conf.backup.$(date +%Y%m%d_%H%M%S)

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cat > /etc/chrony/chrony.conf << 'EOF'
# [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 3]
EOF

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
chmod 666 /dev/ptp*
mkdir -p /var/log/chrony
chown chrony:chrony /var/log/chrony

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã
systemctl restart chrony
systemctl enable chrony

echo "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!"
echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: chronyc tracking"
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ crontab
sudo crontab -e

# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É:
*/5 * * * * /usr/local/bin/quantum-timekeeper-monitor.sh >> /var/log/quantum-timekeeper.log 2>&1
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ KPI

### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

1. **–¢–æ—á–Ω–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**
   - Offset < 10 –º—Å (–æ—Ç–ª–∏—á–Ω–æ)
   - Offset < 100 –º—Å (—Ö–æ—Ä–æ—à–æ)
   - Offset > 100 –º—Å (—Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è)

2. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —á–∞—Å—Ç–æ—Ç—ã:**
   - –î—Ä–µ–π—Ñ < 100 ppm (–æ—Ç–ª–∏—á–Ω–æ)
   - –î—Ä–µ–π—Ñ < 500 ppm (—Ö–æ—Ä–æ—à–æ)
   - –î—Ä–µ–π—Ñ > 500 ppm (—Ç—Ä–µ–±—É–µ—Ç –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏)

3. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:**
   - Uptime > 99.9%
   - –í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è < 30 —Å–µ–∫—É–Ω–¥

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–±-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Quantum-PCI –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è:

```bash
# –ó–∞–ø—É—Å–∫ –≤–µ–±-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
cd /home/shiwa-time/QuantumPCI-DRV/quantum-pci-monitoring
python3 api/quantum-pci-realistic-api.py
```

–î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É: http://localhost:8080

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ NTP —Å–µ—Ä–≤–µ—Ä—É:**
   ```bash
   # –í /etc/chrony/chrony.conf
   allow 192.168.1.0/24  # –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å
   deny all
   ```

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
   chronyc clients
   
   # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
   log measurements
   ```

3. **–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
   ```bash
   # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
   sudo apt update && sudo apt upgrade
   
   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   chronyd -t
   ```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Chrony Documentation](https://chrony.tuxfamily.org/documentation.html)
- [PTP Hardware Clock](https://www.kernel.org/doc/html/latest/driver-api/ptp.html)
- [Quantum-PCI Driver](https://github.com/SiwaNetwork/QuantumPCI-DRV)

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```bash
# –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
chronyc sources -v
chronyc sourcestats -v
chronyc tracking -v

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —á–∞—Å–æ–≤
hwclock --show
timedatectl status

# –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
sudo journalctl -u chrony -f
sudo tail -f /var/log/chrony/chrony.log
```

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–î–∞–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Quantum-PCI –∫–∞–∫ –Ω–∞–¥–µ–∂–Ω—ã–π —Ö—Ä–∞–Ω–∏—Ç–µ–ª—å –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ –∫–∞—Ä—Ç–∞ –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –±–µ–∑ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø—Ä–∏–µ–º–Ω–∏–∫–æ–≤. –°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- **–í—ã—Å–æ–∫—É—é —Ç–æ—á–Ω–æ—Å—Ç—å** —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å NTP —Å–µ—Ä–≤–µ—Ä–∞–º–∏
- **–ê–≤—Ç–æ–Ω–æ–º–Ω—É—é —Ä–∞–±–æ—Ç—É** –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–µ—Ç–∏
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** –≤—ã—Å–æ–∫–æ—Ç–æ—á–Ω–æ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
- **NTP —Å–µ—Ä–≤–µ—Ä** –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Å–∏—Å—Ç–µ–º—ã

–ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 10 –º—Å –∏ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–Ω–æ–º–Ω–æ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
