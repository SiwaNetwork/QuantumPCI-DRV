# –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ LED –¥–ª—è TimeCard

## üéØ –û–±–∑–æ—Ä

–£—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤–µ—Ç–æ–¥–∏–æ–¥–∞–º–∏ IS32FL3207 —Å –¥—Ä–∞–π–≤–µ—Ä–æ–º TimeCard `ptp_ocp.c`.

## üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –£—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:

1. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ TimeCard**
   - TimeCard –Ω–∞–π–¥–µ–Ω: `3c:00:00:0b:40:20`
   - sysfs –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: `/sys/class/timecard/ocp0/`
   - –°—Ç–∞—Ç—É—Å: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢

2. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ IS32FL3207**
   - I2C —à–∏–Ω–∞: 1
   - –ê–¥—Ä–µ—Å: 0x37
   - –°—Ç–∞—Ç—É—Å: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢

3. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è LED –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞**
   - –í–∫–ª—é—á–µ–Ω–∏–µ —á–∏–ø–∞ (SSD=1)
   - Global Current Control
   - Scaling —Ä–µ–≥–∏—Å—Ç—Ä—ã –¥–ª—è –≤—Å–µ—Ö 18 –∫–∞–Ω–∞–ª–æ–≤
   - –°—Ç–∞—Ç—É—Å: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢

4. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ LED**
   - 18 —Å–≤–µ—Ç–æ–¥–∏–æ–¥–æ–≤
   - PWM —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —è—Ä–∫–æ—Å—Ç—å—é (0x00-0xFF)
   - –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–º LED
   - –°—Ç–∞—Ç—É—Å: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢

5. **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã**
   - –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ
   - –ì—Ä–∞–¥–∏–µ–Ω—Ç —è—Ä–∫–æ—Å—Ç–∏
   - –ë–µ–≥—É—â–∏–π –æ–≥–æ–Ω—å
   - –ì—Ä—É–ø–ø–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
   - –ú–∏–≥–∞–Ω–∏–µ
   - –ü–∞—Ç—Ç–µ—Ä–Ω—ã (—à–∞—Ö–º–∞—Ç–Ω–∞—è –¥–æ—Å–∫–∞, –∑–º–µ–π–∫–∞, —Å–ø–∏—Ä–∞–ª—å)
   - –°—Ç–∞—Ç—É—Å: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### IS32FL3207 –†–µ–≥–∏—Å—Ç—Ä—ã:
- **Control Register (0x00)**: –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —á–∏–ø–∞
- **Global Current Control (0x6E)**: –û–±—â–∏–π —Ç–æ–∫ –¥–ª—è –≤—Å–µ—Ö LED
- **Phase Register (0x49)**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤
- **PWM —Ä–µ–≥–∏—Å—Ç—Ä—ã (0x01-0x23)**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —è—Ä–∫–æ—Å—Ç—å—é LED 1-18
- **Scaling —Ä–µ–≥–∏—Å—Ç—Ä—ã (0x4A-0x5B)**: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è LEDÁà±Â•Ω

### I2C –ö–æ–º–∞–Ω–¥—ã:
```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
sudo i2cset -y 1 0x37 0x00 0x01    # –í–∫–ª—é—á–µ–Ω–∏–µ
sudo i2cset -y 1 0x37 0x6E 0xFF    # Global Current

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ LED
sudo i2cset -y 1 0x37 0x01 0xFF    # LED 1 –Ω–∞ –ø–æ–ª–Ω—É—é —è—Ä–∫–æ—Å—Ç—å
sudo i2cset -y 1 0x37 0x49 0x00    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤

# –ß—Ç–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
sudo i2cget -y 1 0x37 0x01         # –ß—Ç–µ–Ω–∏–µ —è—Ä–∫–æ—Å—Ç–∏ LED 1
```

## üìä –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

### 1. `test_leds.sh` - –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç LED
- –ü—Ä–æ–≤–µ—Ä–∫–∞ TimeCard –∏ IS32FL3207
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
- –¶–∏–∫–ª–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö LED
- –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ —Å —ç–º–æ–¥–∑–∏

### 2. `simple_led_test.sh` - –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç
- –ë–∞–∑–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- 4 —Ç–µ—Å—Ç–∞: –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ, –≥—Ä–∞–¥–∏–µ–Ω—Ç, –≥—Ä—É–ø–ø—ã, —Å—Ç–∞—Ç—É—Å
- –ë—ã—Å—Ç—Ä–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### 3. `liked_monitor.py` - Python –º–æ–Ω–∏—Ç–æ—Ä
- –û–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥
- –ß—Ç–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö LED
- –ü—Ä–µ–¥–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (power_on, warning, error, test)
- –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –≤ JSON
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### 4. `final_led_demo.sh` - –§–∏–Ω–∞–ª—å–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è
- 6 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–π
- –ö—Ä–∞—Ç—ã —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

## üîç –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä–∞–π–≤–µ—Ä–æ–º

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- ‚úÖ **I2C —à–∏–Ω–∞** –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥—Ä–∞–π–≤–µ—Ä–æ–º `ptp_ocp.c`
- ‚úÖ **IS32FL3207** –æ–±–Ω–∞—Ä—É–∂–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ LED** —á–µ—Ä–µ–∑ I2C –∫–æ–º–∞–Ω–¥—ã
- ‚ùå **–ü—Ä—è–º–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** –≤ –¥—Ä–∞–π–≤–µ—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:

1. **–î–æ–±–∞–≤–∏—Ç—å –≤ –¥—Ä–∞–π–≤–µ—Ä:**
   ```c
   struct ptp_ocp_led_controller {
       struct i2c_client *client;
       u8 led_status[18];
       bool enabled;
       struct mutex lock;
   };
   ```

2. **–°–æ–∑–¥–∞—Ç—å sysfs –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
   ```bash
   /sys/class/timecard/ocp0/led_brightness_1
   /sys/class/timecard/ocp0/led_brightness_2
   # ... –¥–ª—è –≤—Å–µ—Ö 18 LED
   ```

3. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º:**
   - –î–æ–±–∞–≤–∏—Ç—å LED –º–µ—Ç—Ä–∏–∫–∏ –≤ Prometheus
   - –°–æ–∑–¥–∞—Ç—å –∞–ª–µ—Ä—Ç—ã –¥–ª—è LED —Å—Ç–∞—Ç—É—Å–æ–≤
   - –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –≤ Grafana

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ LED –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ!**

- **18 —Å–≤–µ—Ç–æ–¥–∏–æ–¥–æ–≤** –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã
- **I2C —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TimeCard** –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞
- **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã** —Ä–∞–±–æ—Ç–∞—é—Ç

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å LED —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –¥—Ä–∞–π–≤–µ—Ä `ptp_ocp.c`
2. –î–æ–±–∞–≤–∏—Ç—å sysfs –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è LED
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å —Å–∏—Å—Ç–µ–º–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
4. –°–æ–∑–¥–∞—Ç—å –∞–ª–µ—Ä—Ç—ã –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é

**–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞: ‚úÖ –ì–û–¢–û–í –ö –ü–†–û–î–ê–ö–®–ï–ù–£** 