# Драйвер PTP

Драйвер для карт точного времени Quantum-PCI TimeCard.

## Поддерживаемые устройства

- Quantum-PCI TimeCard (PCI ID: 0x1d9b:0x0400)
- Orolia ART Card (PCI ID: 0x1ad7:0xa000)
- ADVA Timecard (PCI ID: 0x0b0b:0x0410)

## Инструкции

- [Быстрая инструкция для .bin файлов](БЫСТРАЯ_ИНСТРУКЦИЯ_ДЛЯ_BIN_ФАЙЛОВ.md) — работа с готовыми прошивками
- [Работа с прошивками](ИНСТРУКЦИЯ_ПО_РАБОТЕ_С_ПРОШИВКАМИ.md) — создание и переключение типов прошивок
- [Прошивка программатором](ИНСТРУКЦИЯ_ПРОШИВКИ_ПРОГРАММАТОРОМ.md) — прошивка через MTD устройства
- [Добавление новых устройств](ДОБАВЛЕНИЕ_НОВЫХ_УСТРОЙСТВ.md) — для разработчиков

## Быстрый старт

1. Убедитесь, что опция vt-d включена в BIOS
2. Выполните перекомпиляцию: `make`
3. Загрузите модуль: `sudo modprobe ptp_ocp`

## Устройства после загрузки

После успешной загрузки драйвера создаются:
- PTP часы: `/dev/ptp4`
- GNSS порт: `/dev/ttyS5`
- MAC порт: `/dev/ttyS6`
- NMEA порт: `/dev/ttyS7`
- I2C устройства: `/dev/i2c-*`

## Управление через sysfs

Основные настройки доступны в `/sys/class/timecard/ocp0/`:
- `clock_source` — выбор источника времени
- `gnss_sync` — статус синхронизации с GNSS
- `sma1-sma4` — настройка SMA коннекторов
- `serialnum` — серийный номер устройства

## Драйвер включен в основное ядро Linux

- Первоначальная версия: [5.2](https://git.kernel.org/pub/scm/linux/kernel/git/netdev/net-next.git/commit/?id=a7e1abad13f3f0366ee625831fecda2b603cdc17)
- Полная версия: [5.15](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=773bda96492153e11d21eb63ac814669b51fc701)