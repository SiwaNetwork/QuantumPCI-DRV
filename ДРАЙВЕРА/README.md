# –î—Ä–∞–π–≤–µ—Ä
–î—Ä–∞–π–≤–µ—Ä –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —è–¥—Ä–µ–Ω–æ–º –º–æ–¥—É–ª–µ –¥–ª—è CentOS –∏ Ubuntu. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —è–¥—Ä–æ –≤–µ—Ä—Å–∏–∏ 5.12 –∏ –≤—ã—à–µ.

> üìå **–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**: –°–º. [TIMECARD_–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–ê–Ø.md](../TIMECARD_–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–ê–Ø.md)

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- Facebook TimeCard (PCI ID: 0x1d9b:0x0400)
- Celestica TimeCard (PCI ID: 0x18d4:0x1008)
- Orolia ART Card (PCI ID: 0x1ad7:0xa000)

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å–º. [–î–û–ë–ê–í–õ–ï–ù–ò–ï_–ù–û–í–´–•_–£–°–¢–†–û–ô–°–¢–í.md](–î–û–ë–ê–í–õ–ï–ù–ò–ï_–ù–û–í–´–•_–£–°–¢–†–û–ô–°–¢–í.md)

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ê–Ω–∞–ª–∏–∑ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥—Ä–∞–π–≤–µ—Ä–∞
- [–ê–ù–ê–õ–ò–ó_–î–†–ê–ô–í–ï–†–ê.md](–ê–ù–ê–õ–ò–ó_–î–†–ê–ô–í–ï–†–ê.md) - –æ–±—â–∏–π –∞–Ω–∞–ª–∏–∑ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –¥—Ä–∞–π–≤–µ—Ä–∞
- [–°–¢–†–£–ö–¢–£–†–ê_–î–†–ê–ô–í–ï–†–ê.md](–°–¢–†–£–ö–¢–£–†–ê_–î–†–ê–ô–í–ï–†–ê.md) - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥—Ä–∞–π–≤–µ—Ä–∞

### –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ PCI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [–°–û–ü–û–°–¢–ê–í–õ–ï–ù–ò–ï_PCI_–î–†–ê–ô–í–ï–†–ê.md](–°–û–ü–û–°–¢–ê–í–õ–ï–ù–ò–ï_PCI_–î–†–ê–ô–í–ï–†–ê.md) - –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –¥—Ä–∞–π–≤–µ—Ä–∞ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ PCI —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- [–¢–ê–ë–õ–ò–¶–ê_–°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø_PCI.md](–¢–ê–ë–õ–ò–¶–ê_–°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø_PCI.md) - —Ç–∞–±–ª–∏—Ü—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ñ—É–Ω–∫—Ü–∏–π, —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π PCI

### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- [SYSFS_–ò–ù–¢–ï–†–§–ï–ô–°.md](SYSFS_–ò–ù–¢–ï–†–§–ï–ô–°.md) - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö sysfs –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∏ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ –ø—Ä–∏–º–µ—Ä—ã
- [–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò_–ü–û_–£–õ–£–ß–®–ï–ù–ò–Æ.md](–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò_–ü–û_–£–õ–£–ß–®–ï–ù–ò–Æ.md) - –≤–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥—Ä–∞–π–≤–µ—Ä–∞
- [–ü–†–ò–ú–ï–†_–î–û–ë–ê–í–õ–ï–ù–ò–Ø_–£–°–¢–†–û–ô–°–¢–í–ê.c](–ü–†–ò–ú–ï–†_–î–û–ë–ê–í–õ–ï–ù–ò–Ø_–£–°–¢–†–û–ô–°–¢–í–ê.c) - –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- [–ü–†–ò–ú–ï–†_POWER_MANAGEMENT.c](–ü–†–ò–ú–ï–†_POWER_MANAGEMENT.c) - –ø—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∏—Ç–∞–Ω–∏–µ–º

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
–î–ª—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è —Å –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ —É–ª—É—á—à–µ–Ω–∏—è–º–∏ –¥—Ä–∞–π–≤–µ—Ä–∞ —Å–º. [–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò_–ü–û_–£–õ–£–ß–®–ï–ù–ò–Æ.md](–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò_–ü–û_–£–õ–£–ß–®–ï–ù–ò–Æ.md)

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ sysfs –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∏ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–º. [SYSFS_–ò–ù–¢–ï–†–§–ï–ô–°.md](SYSFS_–ò–ù–¢–ï–†–§–ï–ô–°.md)

# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–ø—Ü–∏—è vt-d –≤–∫–ª—é—á–µ–Ω–∞ –≤ BIOS.
–í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–∫–æ–º–ø–∏–ª—è—Ü–∏—é (remake), –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ modprobe ptp_ocp.

## –†–µ–∑—É–ª—å—Ç–∞—Ç
```
$ ls -g /sys/class/timecard/ocp0/
total 0
-r--r--r--. 1 root 4096 Sep  8 18:20 available_clock_sources
-r--r--r--. 1 root 4096 Sep  8 18:20 available_sma_inputs
-r--r--r--. 1 root 4096 Sep  8 18:20 available_sma_outputs
-rw-r--r--. 1 root 4096 Sep  8 18:20 clock_source
lrwxrwxrwx. 1 root    0 Sep  8 18:20 device -> ../../../0000:02:00.0
-rw-r--r--. 1 root 4096 Sep  8 18:20 external_pps_cable_delay
-r--r--r--. 1 root 4096 Sep  8 18:20 gnss_sync
-rw-r--r--. 1 root 4096 Sep  8 18:20 internal_pps_cable_delay
-rw-r--r--. 1 root 4096 Sep  8 18:20 irig_b_mode
-rw-r--r--. 1 root 4096 Sep  8 18:20 pci_delay
drwxr-xr-x. 2 root    0 Sep  8 18:20 power
lrwxrwxrwx. 1 root    0 Sep  8 18:20 ptp -> ../../ptp/ptp4
-r--r--r--. 1 root 4096 Sep  8 18:20 serialnum
-rw-r--r--. 1 root 4096 Sep  8 18:20 sma1_in
-rw-r--r--. 1 root 4096 Sep  8 18:20 sma2_in
-rw-r--r--. 1 root 4096 Sep  8 21:04 sma3_out
-rw-r--r--. 1 root 4096 Sep  8 21:04 sma4_out
lrwxrwxrwx. 1 root    0 Sep  8 18:20 subsystem -> ../../../../../../class/timecard
lrwxrwxrwx. 1 root    0 Sep  8 18:20 ttyGNSS -> ../../tty/ttyS5
lrwxrwxrwx. 1 root    0 Sep  8 18:20 ttyMAC -> ../../tty/ttyS6
lrwxrwxrwx. 1 root    0 Sep  8 18:20 ttyNMEA -> ../../tty/ttyS7
-rw-r--r--. 1 root 4096 Sep  8 18:20 uevent
-rw-r--r--. 1 root 4096 Sep  8 18:20 utc_tai_offset
```

–û—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–∞–ª–æ–≥ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É `/sys/class/timecard/ocpN/`, –≥–¥–µ N - –Ω–æ–º–µ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ocp0, ocp1), –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã TimeCard. –°—Å—ã–ª–∫–∏ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ª–µ–≥–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö:

```
  tty=$(basename $(readlink /sys/class/timecard/ocp0/ttyGNSS))
  ptp=$(basename $(readlink /sys/class/timecard/ocp0/ptp))

  echo "/dev/$tty"
  echo "/dev/$ptp"
```

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥—Ä–∞–π–≤–µ—Ä–∞ –ø–æ—è–≤—è—Ç—Å—è:
* PTP POSIX clock, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–º —á–∞—Å–∞–º–∏ (PHC) –Ω–∞ Qantum Card  (`/dev/ptp4`) 
* GNSS serial `/dev/ttyS5` 
* Atomic clock serial `/dev/ttyS6`
* NMEA Master serial `/dev/ttyS7`
* i2c (`/dev/i2c-*`) device

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã linuxptp, —Ç–∞–∫–∏–µ –∫–∞–∫ phc2sys –∏–ª–∏ ts2phc –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —Ç.–¥. 

## –î—Ä–∞–π–≤–µ—Ä –≤–∫–ª—é—á–µ–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–µ —è–¥—Ä–æ Linux
* –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è ([5.2](https://git.kernel.org/pub/scm/linux/kernel/git/netdev/net-next.git/commit/?id=a7e1abad13f3f0366ee625831fecda2b603cdc17))
* –í–µ—Ä—Å–∏—è, —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–∞—è –≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ ([5.15](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=773bda96492153e11d21eb63ac814669b51fc701)) 